#!perl -w
use strict;

use YAML;

my $a = join "", <>;
my $h = Load($a);

print '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>Manager documentation</title>
    <style type="text/css">
      body {
        font-size: 80%;
        font-family: "Lucida Grande", Verdana, Arial, Sans-Serif;
      }
      h2 {
        border-bottom: solid 1px black;
      }
      .description {
        background: #fcc;
        border: solid 1px #800;
        padding: 1em;
      }
      .method {
        background: #ccc;
        border: solid 1px #444;
        padding: 0.5em 1em 0.5em 1em;
        margin: 1em;
      }
    </style>
  </head>
<body>';

my @managers = sort keys %{$h};

print "<ul>\n";
for my $manager (@managers) {
    print "<li><a href='#$manager'>$manager</a></li>\n";
}
print "</ul>\n";

for my $manager (@managers) {
    my $classes = join ', ', @{$h->{$manager}{Classes}};
    print "<h2 id='$manager'>$manager ($classes)</h2>\n";
    print "<p class='description'>", $h->{$manager}{Description}, "</p>\n";

    for my $m (@{$h->{$manager}{Methods}}) {
        print "<div class='method'>\n";
        my $k = (keys(%$m))[0];
        print "<h3>$k</h3>\n<dl>\n";
        for my $kk (qw<summary params>) {
            my @a = @{$m->{$k}};
            for my $plx (@a) {
                my $vv = $plx->{$kk} || '';
                # Used HTML::EscapeEvil, but the module truncated the text for
                # some reason. Doing it manually instead.
                $vv =~ s/&/\&amp;/;
                $vv =~ s/</\&lt;/;
                $vv =~ s/>/\&gt;/;
                $vv =~ s/'/\&quot;/;
                $vv =~ s/"/\&#34;/;
                # Java newlines replaced by HTML newlines
                $vv =~ s/\\n/<br>/;
                if ($vv) {
                    print "<dt>$kk</dt><dd>$vv</dd>\n"
                }
            }
        }
        print "</dl>\n</div>\n"
    }
}
print "</body>\n</html>\n";
