<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBatis.com//iBatis.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<!--+
    | Copyright (c) 2007 Bioclipse Project
    | All rights reserved. This program and the accompanying materials
    | are made available under the terms of the Eclipse Public License v1.0
    | which accompanies this distribution, and is available at
    | http://www.eclipse.org/legal/epl-v10.html
    +-->
<sqlMap>
<!--+
    | RESULTMAPS
    +-->
	<resultMap class="BaseObject" id="BaseObject">
		<result property="id"         column="id"                               />
		<result property="created"    column="created"                          />
		<result property="edited"     column="edited"                           />
		<result property="creator"    column="creator"    select="User.getById" />
		<result property="lastEditor" column="lastEditor" select="User.getById" />
	</resultMap>

	<resultMap class="Folder" id="Folder" extends="BaseObject">
		<result property="structures" column="id" select="Folder.getStructures" />
		<result property="name"       column="name"                             />
	</resultMap>
	
	<resultMap class="Structure" id="Structure" extends="BaseObject">
		<result property="folder"            column="folder" select="Folder.getById" />
		<result property="fingerPrintString" column="fingerPrintString"              />
		<result property="smiles"            column="smiles"                         />
		<result property="moleculeCML"       column="molecule"                       />
		<result property="name"              column="name"                           />
	</resultMap>

	<resultMap class="Structure" id="Structure-without-folder" extends="BaseObject">
		<result property="fingerPrintString" column="fingerPrintString"                />
		<result property="smiles"            column="smiles"                           />
		<result property="moleculeCML"       column="molecule"                         />
		<result property="name"              column="name"                             />
	</resultMap>
	
	<resultMap class="User" id="User" extends="BaseObject">
		<result property="userName"      column="userName" />
		<result property="passWordMd5"   column="passWord" />
		<result property="sudoer"        column="sudoer"   />
	</resultMap>

<!--+
    | SQL FRAGMENTS
    +-->
	<sql id="BaseObject-fields">
		b.id         AS id,
		b.created    AS created,
		b.edited     AS edited,
		b.creator    AS creator,
		b.lastEditor AS lastEditor	
	</sql>
	
	<sql id="Structure-fields">
		s.folder           AS folder,
		<include refid="Structure-fields-without-folder" />
	</sql>
	
	<sql id="Structure-fields-without-folder">
		s.fingerPrintString AS fingerPrintString,
		s.smiles            AS smiles,
		s.molecule          AS molecule,
		s.name              AS name	
	</sql>
	
	<sql id="User-fields">
		u.userName AS userName,
		u.passWord AS passWord,
		u.sudoer   AS sudoer
	</sql>
	
	<sql id="Folder-fields">
	   l.name AS name
	</sql>
	
<!--+
    | INSERT STATEMENTS
    +-->
	<insert id="BaseObject.insert">
		INSERT INTO BaseObject (  id,     created,     edited,     creator,        lastEditor )
			            VALUES ('$id$', '$created$', '$edited$', '$creator.id$', '$lastEditor.id$')
	</insert>
	
	<insert id="BaseObject.insertWithoutAuditInfo">
        INSERT INTO BaseObject (  id   )
                        VALUES ('$id$' )
    </insert>
	
	<insert id="User.insert">
		INSERT INTO User (   id,     userName,     passWord,        sudoer,     baseObject )
			      VALUES ( '$id$', '$userName$', '$passWordMd5$', '$sudoer$', '$id$'       );
	</insert>
	
	<insert id="Structure.insert">
		INSERT INTO Structure (   id,     name,     baseObject, folder,        smiles,     fingerPrintString,     molecule      )
		               VALUES ( '$id$', '$name$', '$id$',     '$folder.id$', '$smiles$', '$fingerPrintString$', '$moleculeCML$' ); 
	</insert>
	
	<insert id="Structure.insertWithoutFolder">
		INSERT INTO Structure (   id,     name,     baseObject, smiles,     fingerPrintString,     molecule      )
		               VALUES ( '$id$', '$name$', '$id$',     '$smiles$', '$fingerPrintString$', '$moleculeCML$' );
	</insert>
	
	<insert id="Folder.insert">
		INSERT INTO Folder (   id,     baseObject, name   )
		             VALUES ( '$id$', '$id$',     '$name$' );
	</insert>
	
<!--+
    | SELECT STATEMENTS
    +-->
	<select id="Structure.getById" parameterClass="String" resultMap="Structure">
		SELECT 
			<include refid="BaseObject-fields" />, 
			<include refid="Structure-fields"  />
		FROM
			Structure s INNER JOIN BaseObject b ON
			s.baseObject = b.id
		WHERE 
			s.id = #value#
	</select>
	
	<select id="User.getById" parameterClass="String" resultMap="User">
		SELECT 
			<include refid="BaseObject-fields" />,
			<include refid="User-fields"       />
		FROM
			User u INNER JOIN BaseObject b ON
			u.baseObject = b.id
		WHERE 
			u.id = #value#
	</select>
	
	<select id="User.getByUsername" parameterClass="String" resultMap="User">
        SELECT 
            <include refid="BaseObject-fields" />,
            <include refid="User-fields"       />
        FROM
            User u INNER JOIN BaseObject b ON
            u.baseObject = b.id
        WHERE 
            u.username = #value#
    </select>
	
	<select id="Folder.getById" resultMap="Folder" parameterClass="String">
		SELECT 
			<include refid="BaseObject-fields" />,
			<include refid="Folder-fields"    />
		FROM
			Folder l INNER JOIN BaseObject b ON
			l.baseObject = b.id
		WHERE 
			l.id = #value#
	</select>
	
	<select id="Folder.getByName" resultMap="Folder" parameterClass="String">
        SELECT 
            <include refid="BaseObject-fields" />,
            <include refid="Folder-fields"    />
        FROM
            Folder l INNER JOIN BaseObject b ON
            l.baseObject = b.id
        WHERE 
            l.name = #value#
    </select>
	
	<select id="Folder.getStructures" resultMap="Structure-without-folder" parameterClass="String">
		SELECT 
			<include refid="BaseObject-fields" />,
			<include refid="Structure-fields-without-folder"  />
		FROM
			Structure s INNER JOIN BaseObject b ON
			s.baseObject = b.id
		WHERE 
			s.folder = #value#
	</select>
	
	<select id="Structure.getAll" resultMap="Structure">
		SELECT
			<include refid="BaseObject-fields" />, 
			<include refid="Structure-fields"  />
		FROM
			Structure s INNER JOIN BaseObject b ON
			s.baseObject = b.id
	</select>
	
	<select id="Structure.getByName" resultMap="Structure" parameterClass="String">
        SELECT
            <include refid="BaseObject-fields" />, 
            <include refid="Structure-fields"  />
        FROM
            Structure s INNER JOIN BaseObject b ON
            s.baseObject = b.id
        WHERE
            s.name = #value#
    </select>
	
	<select id="Folder.getAll" resultMap="Folder">
		SELECT
			<include refid="BaseObject-fields" />,
			<include refid="Folder-fields"     />
		FROM
			Folder l INNER JOIN BaseObject b ON
			l.baseObject = b.id
	</select>

	<select id="User.getAll" resultMap="User">
		SELECT 
			<include refid="BaseObject-fields" />,
			<include refid="User-fields"       />
		FROM
			User u INNER JOIN BaseObject b ON
			u.baseObject = b.id
	</select>
	
<!--+
    | DELETE STATEMENTS
    +-->	
	<delete id="BaseObject.delete" parameterClass="String">
		DELETE FROM BaseObject
		WHERE id='$value$';
	</delete>
<!--+
    | UPDATE STATEMENTS
    +-->
    <update id="BaseObject.update" parameterClass="BaseObject">
    	UPDATE 
    		BaseObject
    	SET 
			created    = '$created$',
			edited     = '$edited$',
			creator    = '$creator.id$',
			lastEditor = '$lastEditor.id$'	
		WHERE
			id = '$id$'
    </update>
    
    <update id="User.update" parameterClass="User">
    	UPDATE 
    		User
    	SET 
	    	userName = '$userName$',
			passWord = '$passWordMd5$',
			sudoer   = '$sudoer$'
		WHERE
			id = '$id$'
    </update>
    
    <update id="Folder.update" parameterClass="Folder">
        UPDATE
            Folder
        SET
            name = '$name$'
        WHERE
            id = '$id$'    	
    </update>
    
    <update id="Structure.update" parameterClass="Structure">
    	UPDATE 
    		Structure
    	SET 
	    	folder            = '$folder.id$',
	    	smiles            = '$smiles$',
	    	fingerPrintString = '$fingerPrintString$',
	    	molecule          = '$moleculeCML$',
	    	name              = '$name$'
		WHERE
			id = '$id$'
    </update>
    
    <update id="Structure-without-folder.update" parameterClass="Structure">
    	UPDATE 
    		Structure
    	SET 
	    	smiles            = '$smiles$',
	    	fingerPrintString = '$fingerPrintString$',
	    	molecule          = '$moleculeCML$',
	    	name              = '$name$'
		WHERE
			id = '$id$'
    </update>
    
    <update id="Structure.setFolder" parameterClass="java.util.Map">
        UPDATE
            Structure
        SET
            folder = '$folderId$'
        WHERE
            id = '$structureId$'
    </update>
  
</sqlMap>